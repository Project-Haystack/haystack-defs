//
// Copyright (c) 2011, Project-Haystack
// Licensed under the Academic Free License version 3.0
//
// History:
//   22 Feb 2011  Brian Frank  Creation
//    9 Jan 2019  Brian Frank  New design
//

--------------------------------------------------------------------------
def: ^meter
is: ^equip
meterScope: ^meterScopeType
doc: "Equipment to meter a substance or phenomenon"
--------------------------------------------------------------------------
def: ^elec-meter
is: ^meter
doc: "Electricity meter"
--------------------------------------------------------------------------
def: ^ac-elec-meter
is: ^elec-meter
doc: "AC Electricity meter"
children:
  // TODO: how to deal with explosion?
  // energy
  total net energy sensor point
  total import energy sensor point
  total export energy sensor point
  phase:"A" net energy sensor point

  // power
  total active power sensor point
  total reactive power sensor point
  total apparent power sensor point
  phase:"A" active power sensor point
  phase:"A" reactive power sensor point
  phase:"A" apparent power sensor point

  // current
  avg current magnitude sensor point
  avg current angle sensor point
  avg current imbalance sensor point
  avg current thd sensor point
  phase:"A" current magnitude sensor point
  phase:"A" current angle sensor point
  phase:"A" current imbalance sensor point
  phase:"A" current thd sensor point

  // volt
  avg volt magnitude sensor point
  avg volt angle sensor point
  avg volt imbalance sensor point
  avg volt thd sensor point
  phase:"A" volt magnitude sensor point
  phase:"A" volt angle sensor point
  phase:"A" volt imbalance sensor point
  phase:"A" volt thd sensor point

  // power factor
  avg pf sensor point
  phase:"A" pf sensor point
--------------------------------------------------------------------------
def: ^dc-elec-meter
is: ^elec-meter
doc: "DC Electricity meter"
--------------------------------------------------------------------------
def: ^flow-meter
is: ^meter
doc: "Meter to measure flow rate and total volume of fluid"
--------------------------------------------------------------------------
def: ^thermal-meter
is: ^meter
doc: "Meter to measure energy transfer via fluid"
--------------------------------------------------------------------------

//////////////////////////////////////////////////////////////////////////
// MeterScope
//////////////////////////////////////////////////////////////////////////

--------------------------------------------------------------------------
def: ^meterScope
is: ^choice
of: ^meterScopeType
doc: "Classifies a meter as a main site meter or submeter"
--------------------------------------------------------------------------
def: ^meterScopeType
is: ^marker
doc: "Classifies a meter as a main site meter or submeter"
--------------------------------------------------------------------------
def: ^siteMeter
is: ^meterScopeType
doc: "Main meter for the associated site"
--------------------------------------------------------------------------
def: ^submeter
is: ^meterScopeType
doc: "Submeters measure usage of a sub-system or equipment within a site"
--------------------------------------------------------------------------
//////////////////////////////////////////////////////////////////////////
// Relationships
//////////////////////////////////////////////////////////////////////////

--------------------------------------------------------------------------
def: ^submeterOf
is: ^ref
of: ^meter
tagOn: ^meter
doc: "Reference to parent meter which is immediately upstream of this meter"
--------------------------------------------------------------------------

